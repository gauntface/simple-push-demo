{"version":3,"sources":["scripts/app-controller.js"],"names":["e","t","n","r","s","o","u","a","require","i","f","Error","code","l","exports","call","length","1","module","_classCallCheck","instance","Constructor","TypeError","_createClass","defineProperties","target","props","descriptor","enumerable","configurable","writable","Object","defineProperty","key","protoProps","staticProps","prototype","PushClient","stateChangeCb","subscriptionUpdate","_this","this","_stateChangeCb","_subscriptionUpdate","_state","UNSUPPORTED","id","interactive","pushEnabled","INITIALISING","PERMISSION_DENIED","PERMISSION_GRANTED","PERMISSION_PROMPT","ERROR","STARTING_SUBSCRIBE","SUBSCRIBED","STARTING_UNSUBSCRIBE","UNSUBSCRIBED","navigator","window","ServiceWorkerRegistration","serviceWorker","ready","then","setUpPushPermission","value","permissionState","console","error","_this2","_permissionStateChange","Notification","permission","serviceWorkerRegistration","pushManager","getSubscription","subscription","err","log","_this3","Promise","resolve","reject","requestPermission","result","subscribe","userVisibleOnly","subscriptionErr","_this4","pushSubscription","unsubscribe","successful","HMAC","ikm","_ikm","input","crypto","subtle","importKey","name","hash","sign","gauntface","HKDF","salt","_salt","_hmac","info","byteLength","fullInfoBuffer","Uint8Array","set","fill","prk","nextHmac","nextPrk","slice","PRIVATE_KEY_BYTES","PUBLIC_KEY_BYTES","SALT_BYTES","joinUnit8Arrays","allUint8Arrays","reduce","cumulativeValue","nextValue","joinedArray","EncryptionHelper","serverKeys","publicKey","privateKey","_serverKeys","publicKeyString","_this5","stringKeysToCryptoKeys","keys","CryptoKey","algorithm","namedCurve","public","deriveBits","getPrivateServerKey","_this6","exportCryptoKeys","clientPublicKey","getPublicServerKey","serverPublicKey","utf8Encoder","TextEncoder","labelUnit8Array","encode","paddingUnit8Array","clientPublicKeyLengthUnit8Array","serverPublicKeyLengthBuffer","_this7","contentEncoding8Array","generateContext","contextBuffer","_this8","getSharedSecret","p256dh","sharedSecret","authInfoUint8Array","hkdf","base64UrlToUint8Array","auth","generate","_this9","all","generatePRK","generateCEKInfo","generateNonceInfo","results","cekInfo","nonceInfo","cekHKDF","nonceHKDF","contentEncryptionKey","nonce","payload","_this10","generateEncryptionKeys","encryptionKeys","contentEncryptionCryptoKey","paddingBytes","payloadUint8Array","recordUint8Array","tagLength","iv","encrypt","encryptedPayloadArrayBuffer","cipherText","uint8ArrayToBase64Url","getSalt","publicServerKey","promises","push","exportKey","jwk","x","y","d","exportedKeys","publicKeyUnitArray","publicBuffer","kty","crv","ext","keyPromises","privateKeyArray","keyPair","uint8Array","start","end","base64","btoa","String","fromCharCode","apply","replace","base64UrlData","padding","repeat","rawData","atob","buffer","charCodeAt","EncryptionHelperFactory","options","importKeys","generateKeys","getRandomValues","generateKey","MaterialComponentsSnippets","snippets","document","querySelectorAll","_this11","Array","from","forEach","snippet","addEventListener","onMouseClickHandler","onMouseOutHandler","selection","getSelection","range","createRange","selectNodeContents","removeAllRanges","addRange","execCommand","_this12","toString","copyToClipboard","classList","add","CssClasses_","COPIED","NOT_SUPPORTED","remove","get","AppController","_this13","_PUSH_SERVER_URL","_API_KEY","_sendPushOptions","querySelector","_payloadTextField","_stateMsg","oninput","updateCurlCommand","updateXHRButton","updateOrMessage","toggleSwitch","contains","_uiInitialised","MaterialSwitch","mdlUpgradeCb","removeEventListener","_this14","_stateChangeListener","bind","_toggleSwitch","_pushClient","event","checked","subscribeDevice","unsubscribeDevice","sendPushViaXHRButton","_currentSubscription","sendPushMessage","init","_this15","register","showErrorMessage","state","data","enable","disable","on","off","_this16","style","opacity","payloadTextfieldContainer","subscriptionObject","JSON","parse","stringify","_this17","payloadText","payloadPromise","trim","generateHelper","encryptionHelper","encryptMessage","encryptedPayload","curlContainer","curlCommand","endpoint","indexOf","produceGCMProprietaryCURLCommand","display","textContent","produceWebPushProtocolCURLCommand","curlCodeElement","innerHTML","buttonContainer","orMessage","orDisplay","_this18","useGCMProtocol","useWebPushProtocol","arrayBuffer","partialBuffer","_this19","headers","Headers","append","endpointSections","split","subscriptionId","msgBody","registration_ids","raw_data","toBase64","fetch","method","body","response","type","json","responseObj","failure","_this20","fetchOptions","status","additionalHeaders","additionalBody","curlEndpoint","title","message","errorContainer","titleElement","messageElement","pushOptionsContainer"],"mappings":"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","file":"scripts/app-controller.js","sourcesContent":["(function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a=typeof require==\"function\"&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);var f=new Error(\"Cannot find module '\"+o+\"'\");throw f.code=\"MODULE_NOT_FOUND\",f}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return s(n?n:e)},l,l.exports,e,t,n,r)}return n[o].exports}var i=typeof require==\"function\"&&require;for(var o=0;o<r.length;o++)s(r[o]);return s})({1:[function(require,module,exports){\n'use strict';\n\n/* eslint-env browser */\n\nvar _createClass = function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if (\"value\" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; }();\n\nfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\nvar PushClient = function () {\n  function PushClient(stateChangeCb, subscriptionUpdate) {\n    var _this = this;\n\n    _classCallCheck(this, PushClient);\n\n    this._stateChangeCb = stateChangeCb;\n    this._subscriptionUpdate = subscriptionUpdate;\n\n    this._state = {\n      UNSUPPORTED: {\n        id: 'UNSUPPORTED',\n        interactive: false,\n        pushEnabled: false\n      },\n      INITIALISING: {\n        id: 'INITIALISING',\n        interactive: false,\n        pushEnabled: false\n      },\n      PERMISSION_DENIED: {\n        id: 'PERMISSION_DENIED',\n        interactive: false,\n        pushEnabled: false\n      },\n      PERMISSION_GRANTED: {\n        id: 'PERMISSION_GRANTED',\n        interactive: true\n      },\n      PERMISSION_PROMPT: {\n        id: 'PERMISSION_PROMPT',\n        interactive: true,\n        pushEnabled: false\n      },\n      ERROR: {\n        id: 'ERROR',\n        interactive: false,\n        pushEnabled: false\n      },\n      STARTING_SUBSCRIBE: {\n        id: 'STARTING_SUBSCRIBE',\n        interactive: false,\n        pushEnabled: true\n      },\n      SUBSCRIBED: {\n        id: 'SUBSCRIBED',\n        interactive: true,\n        pushEnabled: true\n      },\n      STARTING_UNSUBSCRIBE: {\n        id: 'STARTING_UNSUBSCRIBE',\n        interactive: false,\n        pushEnabled: false\n      },\n      UNSUBSCRIBED: {\n        id: 'UNSUBSCRIBED',\n        interactive: true,\n        pushEnabled: false\n      }\n    };\n\n    if (!('serviceWorker' in navigator)) {\n      this._stateChangeCb(this._state.UNSUPPORTED);\n      return;\n    }\n\n    if (!('PushManager' in window)) {\n      this._stateChangeCb(this._state.UNSUPPORTED);\n      return;\n    }\n\n    if (!('showNotification' in ServiceWorkerRegistration.prototype)) {\n      this._stateChangeCb(this._state.UNSUPPORTED);\n      return;\n    }\n\n    navigator.serviceWorker.ready.then(function () {\n      _this._stateChangeCb(_this._state.INITIALISING);\n      _this.setUpPushPermission();\n    });\n  }\n\n  _createClass(PushClient, [{\n    key: '_permissionStateChange',\n    value: function _permissionStateChange(permissionState) {\n      // If the notification permission is denied, it's a permanent block\n      switch (permissionState) {\n        case 'denied':\n          this._stateChangeCb(this._state.PERMISSION_DENIED);\n          break;\n        case 'granted':\n          this._stateChangeCb(this._state.PERMISSION_GRANTED);\n          break;\n        case 'default':\n          this._stateChangeCb(this._state.PERMISSION_PROMPT);\n          break;\n        default:\n          console.error('Unexpected permission state: ', permissionState);\n          break;\n      }\n    }\n  }, {\n    key: 'setUpPushPermission',\n    value: function setUpPushPermission() {\n      var _this2 = this;\n\n      this._permissionStateChange(Notification.permission);\n\n      return navigator.serviceWorker.ready.then(function (serviceWorkerRegistration) {\n        // Let's see if we have a subscription already\n        return serviceWorkerRegistration.pushManager.getSubscription();\n      }).then(function (subscription) {\n        if (!subscription) {\n          // NOOP since we have no subscription and the permission state\n          // will inform whether to enable or disable the push UI\n          return;\n        }\n\n        _this2._stateChangeCb(_this2._state.SUBSCRIBED);\n\n        // Update the current state with the\n        // subscriptionid and endpoint\n        _this2._subscriptionUpdate(subscription);\n      }).catch(function (err) {\n        console.log(err);\n        _this2._stateChangeCb(_this2._state.ERROR, err);\n      });\n    }\n  }, {\n    key: 'subscribeDevice',\n    value: function subscribeDevice() {\n      var _this3 = this;\n\n      this._stateChangeCb(this._state.STARTING_SUBSCRIBE);\n\n      return new Promise(function (resolve, reject) {\n        if (Notification.permission === 'denied') {\n          return reject(new Error('Push messages are blocked.'));\n        }\n\n        if (Notification.permission === 'granted') {\n          return resolve();\n        }\n\n        if (Notification.permission === 'default') {\n          Notification.requestPermission(function (result) {\n            if (result !== 'granted') {\n              reject(new Error('Bad permission result'));\n            }\n\n            resolve();\n          });\n        }\n      }).then(function () {\n        // We need the service worker registration to access the push manager\n        return navigator.serviceWorker.ready.then(function (serviceWorkerRegistration) {\n          return serviceWorkerRegistration.pushManager.subscribe({ userVisibleOnly: true });\n        }).then(function (subscription) {\n          _this3._stateChangeCb(_this3._state.SUBSCRIBED);\n          _this3._subscriptionUpdate(subscription);\n        }).catch(function (subscriptionErr) {\n          _this3._stateChangeCb(_this3._state.ERROR, subscriptionErr);\n        });\n      }).catch(function () {\n        // Check for a permission prompt issue\n        _this3._permissionStateChange(Notification.permission);\n      });\n    }\n  }, {\n    key: 'unsubscribeDevice',\n    value: function unsubscribeDevice() {\n      var _this4 = this;\n\n      // Disable the switch so it can't be changed while\n      // we process permissions\n      // window.PushDemo.ui.setPushSwitchDisabled(true);\n\n      this._stateChangeCb(this._state.STARTING_UNSUBSCRIBE);\n\n      navigator.serviceWorker.ready.then(function (serviceWorkerRegistration) {\n        return serviceWorkerRegistration.pushManager.getSubscription();\n      }).then(function (pushSubscription) {\n        // Check we have everything we need to unsubscribe\n        if (!pushSubscription) {\n          _this4._stateChangeCb(_this4._state.UNSUBSCRIBED);\n          _this4._subscriptionUpdate(null);\n          return;\n        }\n\n        // TODO: Remove the device details from the server\n        // i.e. the pushSubscription.subscriptionId and\n        // pushSubscription.endpoint\n        return pushSubscription.unsubscribe().then(function (successful) {\n          if (!successful) {\n            // The unsubscribe was unsuccessful, but we can\n            // remove the subscriptionId from our server\n            // and notifications will stop\n            // This just may be in a bad state when the user returns\n            console.error('We were unable to unregister from push');\n          }\n        });\n      }).then(function () {\n        _this4._stateChangeCb(_this4._state.UNSUBSCRIBED);\n        _this4._subscriptionUpdate(null);\n      }).catch(function (err) {\n        console.error('Error thrown while revoking push notifications. ' + 'Most likely because push was never registered', err);\n      });\n    }\n  }]);\n\n  return PushClient;\n}();\n\nvar HMAC = function () {\n  function HMAC(ikm) {\n    _classCallCheck(this, HMAC);\n\n    this._ikm = ikm;\n  }\n\n  _createClass(HMAC, [{\n    key: 'sign',\n    value: function sign(input) {\n      return crypto.subtle.importKey('raw', this._ikm, { name: 'HMAC', hash: 'SHA-256' }, false, ['sign']).then(function (key) {\n        return crypto.subtle.sign('HMAC', key, input);\n      });\n    }\n  }]);\n\n  return HMAC;\n}();\n\nif (typeof window !== 'undefined') {\n  window.gauntface = window.gauntface || {};\n  window.gauntface.HMAC = HMAC;\n}\n\nvar HKDF = function () {\n  function HKDF(ikm, salt) {\n    _classCallCheck(this, HKDF);\n\n    this._ikm = ikm;\n    this._salt = salt;\n\n    this._hmac = new HMAC(salt);\n  }\n\n  _createClass(HKDF, [{\n    key: 'generate',\n    value: function generate(info, byteLength) {\n      var fullInfoBuffer = new Uint8Array(info.byteLength + 1);\n      fullInfoBuffer.set(info, 0);\n      fullInfoBuffer.set(new Uint8Array(1).fill(1), info.byteLength);\n\n      return this._hmac.sign(this._ikm).then(function (prk) {\n        var nextHmac = new HMAC(prk);\n        return nextHmac.sign(fullInfoBuffer);\n      }).then(function (nextPrk) {\n        return nextPrk.slice(0, byteLength);\n      });\n    }\n  }]);\n\n  return HKDF;\n}();\n\nif (typeof window !== 'undefined') {\n  window.gauntface = window.gauntface || {};\n  window.gauntface.HKDF = HKDF;\n}\n\n// Length, in bytes, of a P-256 field element. Expected format of the private key.\nvar PRIVATE_KEY_BYTES = 32;\n\n// Length, in bytes, of a P-256 public key in uncompressed EC form per SEC 2.3.3. This sequence must\n// start with 0x04. Expected format of the public key.\nvar PUBLIC_KEY_BYTES = 65;\n\n// Length, in bytes, of the salt that should be used for the message.\nvar SALT_BYTES = 16;\n\nvar joinUnit8Arrays = function joinUnit8Arrays(allUint8Arrays) {\n  // Super inefficient. But easier to follow than allocating the\n  // array with the correct size and position values in that array\n  // as required.\n  return allUint8Arrays.reduce(function (cumulativeValue, nextValue) {\n    var joinedArray = new Uint8Array(cumulativeValue.byteLength + nextValue.byteLength);\n    joinedArray.set(cumulativeValue, 0);\n    joinedArray.set(nextValue, cumulativeValue.byteLength);\n    return joinedArray;\n  }, new Uint8Array());\n};\n\nvar EncryptionHelper = function () {\n  function EncryptionHelper(serverKeys, salt) {\n    _classCallCheck(this, EncryptionHelper);\n\n    if (!serverKeys || !serverKeys.publicKey || !serverKeys.privateKey) {\n      throw new Error('Bad server keys. Use ' + 'EncryptionHelperFactory.generateKeys()');\n    }\n\n    if (!salt) {\n      throw new Error('Bad salt value. Use ' + 'EncryptionHelperFactory.generateSalt()');\n    }\n\n    this._serverKeys = serverKeys;\n    this._salt = salt;\n  }\n\n  _createClass(EncryptionHelper, [{\n    key: 'getPublicServerKey',\n    value: function getPublicServerKey() {\n      return this._serverKeys.publicKey;\n    }\n  }, {\n    key: 'getPrivateServerKey',\n    value: function getPrivateServerKey() {\n      return this._serverKeys.privateKey;\n    }\n  }, {\n    key: 'getSharedSecret',\n    value: function getSharedSecret(publicKeyString) {\n      var _this5 = this;\n\n      return Promise.resolve().then(function () {\n        return EncryptionHelper.stringKeysToCryptoKeys(publicKeyString);\n      }).then(function (keys) {\n        return keys.publicKey;\n      }).then(function (publicKey) {\n        if (!(publicKey instanceof CryptoKey)) {\n          throw new Error('The publicKey must be a CryptoKey.');\n        }\n\n        var algorithm = {\n          name: 'ECDH',\n          namedCurve: 'P-256',\n          public: publicKey\n        };\n\n        return crypto.subtle.deriveBits(algorithm, _this5.getPrivateServerKey(), 256);\n      });\n    }\n  }, {\n    key: 'getSalt',\n    value: function getSalt() {\n      return this._salt;\n    }\n  }, {\n    key: 'generateContext',\n    value: function generateContext(publicKeyString) {\n      var _this6 = this;\n\n      return Promise.resolve().then(function () {\n        return EncryptionHelper.stringKeysToCryptoKeys(publicKeyString);\n      }).then(function (keys) {\n        return EncryptionHelper.exportCryptoKeys(keys.publicKey).then(function (keys) {\n          return keys.publicKey;\n        });\n      }).then(function (clientPublicKey) {\n        return EncryptionHelper.exportCryptoKeys(_this6.getPublicServerKey()).then(function (keys) {\n          return {\n            clientPublicKey: clientPublicKey,\n            serverPublicKey: keys.publicKey\n          };\n        });\n      }).then(function (keys) {\n        var utf8Encoder = new TextEncoder('utf-8');\n        var labelUnit8Array = utf8Encoder.encode('P-256');\n        var paddingUnit8Array = new Uint8Array(1).fill(0);\n\n        var clientPublicKeyLengthUnit8Array = new Uint8Array(2);\n        clientPublicKeyLengthUnit8Array[0] = 0x00;\n        clientPublicKeyLengthUnit8Array[1] = keys.clientPublicKey.byteLength;\n\n        var serverPublicKeyLengthBuffer = new Uint8Array(2);\n        serverPublicKeyLengthBuffer[0] = 0x00;\n        serverPublicKeyLengthBuffer[1] = keys.serverPublicKey.byteLength;\n\n        return joinUnit8Arrays([labelUnit8Array, paddingUnit8Array, clientPublicKeyLengthUnit8Array, keys.clientPublicKey, serverPublicKeyLengthBuffer, keys.serverPublicKey]);\n      });\n    }\n  }, {\n    key: 'generateCEKInfo',\n    value: function generateCEKInfo(publicKeyString) {\n      var _this7 = this;\n\n      return Promise.resolve().then(function () {\n        var utf8Encoder = new TextEncoder('utf-8');\n        var contentEncoding8Array = utf8Encoder.encode('Content-Encoding: aesgcm');\n        var paddingUnit8Array = new Uint8Array(1).fill(0);\n        return _this7.generateContext(publicKeyString).then(function (contextBuffer) {\n          return joinUnit8Arrays([contentEncoding8Array, paddingUnit8Array, contextBuffer]);\n        });\n      });\n    }\n  }, {\n    key: 'generateNonceInfo',\n    value: function generateNonceInfo(publicKeyString) {\n      var _this8 = this;\n\n      return Promise.resolve().then(function () {\n        var utf8Encoder = new TextEncoder('utf-8');\n        var contentEncoding8Array = utf8Encoder.encode('Content-Encoding: nonce');\n        var paddingUnit8Array = new Uint8Array(1).fill(0);\n        return _this8.generateContext(publicKeyString).then(function (contextBuffer) {\n          return joinUnit8Arrays([contentEncoding8Array, paddingUnit8Array, contextBuffer]);\n        });\n      });\n    }\n  }, {\n    key: 'generatePRK',\n    value: function generatePRK(subscription) {\n      return this.getSharedSecret(subscription.keys.p256dh).then(function (sharedSecret) {\n        var utf8Encoder = new TextEncoder('utf-8');\n        var authInfoUint8Array = utf8Encoder.encode('Content-Encoding: auth\\0');\n\n        var hkdf = new HKDF(sharedSecret, EncryptionHelper.base64UrlToUint8Array(subscription.keys.auth));\n        return hkdf.generate(authInfoUint8Array, 32);\n      });\n    }\n  }, {\n    key: 'generateEncryptionKeys',\n    value: function generateEncryptionKeys(subscription) {\n      var _this9 = this;\n\n      return Promise.all([this.generatePRK(subscription), this.generateCEKInfo(subscription.keys.p256dh), this.generateNonceInfo(subscription.keys.p256dh)]).then(function (results) {\n        var prk = results[0];\n        var cekInfo = results[1];\n        var nonceInfo = results[2];\n\n        var cekHKDF = new HKDF(prk, _this9._salt);\n        var nonceHKDF = new HKDF(prk, _this9._salt);\n        return Promise.all([cekHKDF.generate(cekInfo, 16), nonceHKDF.generate(nonceInfo, 12)]);\n      }).then(function (results) {\n        return {\n          contentEncryptionKey: results[0],\n          nonce: results[1]\n        };\n      });\n    }\n  }, {\n    key: 'encryptMessage',\n    value: function encryptMessage(subscription, payload) {\n      var _this10 = this;\n\n      return this.generateEncryptionKeys(subscription).then(function (encryptionKeys) {\n        return crypto.subtle.importKey('raw', encryptionKeys.contentEncryptionKey, 'AES-GCM', true, ['decrypt', 'encrypt']).then(function (contentEncryptionCryptoKey) {\n          encryptionKeys.contentEncryptionCryptoKey = contentEncryptionCryptoKey;\n          return encryptionKeys;\n        });\n      }).then(function (encryptionKeys) {\n        var paddingBytes = 0;\n        var paddingUnit8Array = new Uint8Array(2 + paddingBytes);\n        var utf8Encoder = new TextEncoder('utf-8');\n        var payloadUint8Array = utf8Encoder.encode(payload);\n        var recordUint8Array = new Uint8Array(paddingUnit8Array.byteLength + payloadUint8Array.byteLength);\n        recordUint8Array.set(paddingUnit8Array, 0);\n        recordUint8Array.set(payloadUint8Array, paddingUnit8Array.byteLength);\n\n        var algorithm = {\n          name: 'AES-GCM',\n          tagLength: 128,\n          iv: encryptionKeys.nonce\n        };\n\n        return crypto.subtle.encrypt(algorithm, encryptionKeys.contentEncryptionCryptoKey, recordUint8Array);\n      }).then(function (encryptedPayloadArrayBuffer) {\n        return EncryptionHelper.exportCryptoKeys(_this10.getPublicServerKey()).then(function (keys) {\n          return {\n            cipherText: encryptedPayloadArrayBuffer,\n            salt: EncryptionHelper.uint8ArrayToBase64Url(_this10.getSalt()),\n            publicServerKey: EncryptionHelper.uint8ArrayToBase64Url(keys.publicKey)\n          };\n        });\n      });\n    }\n  }], [{\n    key: 'exportCryptoKeys',\n    value: function exportCryptoKeys(publicKey, privateKey) {\n      return Promise.resolve().then(function () {\n        var promises = [];\n        promises.push(crypto.subtle.exportKey('jwk', publicKey).then(function (jwk) {\n          var x = EncryptionHelper.base64UrlToUint8Array(jwk.x);\n          var y = EncryptionHelper.base64UrlToUint8Array(jwk.y);\n\n          var publicKey = new Uint8Array(65);\n          publicKey.set([0x04], 0);\n          publicKey.set(x, 1);\n          publicKey.set(y, 33);\n\n          return publicKey;\n        }));\n\n        if (privateKey) {\n          promises.push(crypto.subtle.exportKey('jwk', privateKey).then(function (jwk) {\n            return EncryptionHelper.base64UrlToUint8Array(jwk.d);\n          }));\n        }\n\n        return Promise.all(promises);\n      }).then(function (exportedKeys) {\n        var result = {\n          publicKey: exportedKeys[0]\n        };\n\n        if (exportedKeys.length > 1) {\n          result.privateKey = exportedKeys[1];\n        }\n\n        return result;\n      });\n    }\n  }, {\n    key: 'stringKeysToCryptoKeys',\n    value: function stringKeysToCryptoKeys(publicKey, privateKey) {\n      if (!(typeof publicKey === 'string')) {\n        throw new Error('The publicKey is expected to be an String.');\n      }\n\n      var publicKeyUnitArray = EncryptionHelper.base64UrlToUint8Array(publicKey);\n      if (publicKeyUnitArray.byteLength !== PUBLIC_KEY_BYTES) {\n        throw new Error('The publicKey is expected to be ' + PUBLIC_KEY_BYTES + ' bytes.');\n      }\n\n      var publicBuffer = new Uint8Array(publicKeyUnitArray);\n      if (publicBuffer[0] !== 0x04) {\n        throw new Error('The publicKey is expected to start with an ' + '0x04 byte.');\n      }\n\n      var jwk = {\n        kty: 'EC',\n        crv: 'P-256',\n        x: EncryptionHelper.uint8ArrayToBase64Url(publicBuffer, 1, 33),\n        y: EncryptionHelper.uint8ArrayToBase64Url(publicBuffer, 33, 65),\n        ext: true\n      };\n\n      var keyPromises = [];\n      keyPromises.push(crypto.subtle.importKey('jwk', jwk, { name: 'ECDH', namedCurve: 'P-256' }, true, []));\n\n      if (privateKey) {\n        if (!(typeof privateKey === 'string')) {\n          throw new Error('The privateKey is expected to be an String.');\n        }\n\n        var privateKeyArray = EncryptionHelper.base64UrlToUint8Array(privateKey);\n\n        if (privateKeyArray.byteLength !== PRIVATE_KEY_BYTES) {\n          throw new Error('The privateKey is expected to be ' + PRIVATE_KEY_BYTES + ' bytes.');\n        }\n\n        // d must be defined after the importKey call for public\n        jwk.d = EncryptionHelper.uint8ArrayToBase64Url(new Uint8Array(privateKeyArray));\n        keyPromises.push(crypto.subtle.importKey('jwk', jwk, { name: 'ECDH', namedCurve: 'P-256' }, true, ['deriveBits']));\n      }\n\n      return Promise.all(keyPromises).then(function (keys) {\n        var keyPair = {\n          publicKey: keys[0]\n        };\n        if (keys.length > 1) {\n          keyPair.privateKey = keys[1];\n        }\n        return keyPair;\n      });\n    }\n  }, {\n    key: 'uint8ArrayToBase64Url',\n    value: function uint8ArrayToBase64Url(uint8Array, start, end) {\n      start = start || 0;\n      end = end || uint8Array.byteLength;\n\n      var base64 = btoa(String.fromCharCode.apply(null, uint8Array.slice(start, end)));\n      return base64.replace(/\\=/g, '') // eslint-disable-line no-useless-escape\n      .replace(/\\+/g, '-').replace(/\\//g, '_');\n    }\n\n    // Converts the URL-safe base64 encoded |base64UrlData| to an Uint8Array buffer.\n\n  }, {\n    key: 'base64UrlToUint8Array',\n    value: function base64UrlToUint8Array(base64UrlData) {\n      var padding = '='.repeat((4 - base64UrlData.length % 4) % 4);\n      var base64 = (base64UrlData + padding).replace(/\\-/g, '+').replace(/_/g, '/');\n\n      var rawData = atob(base64);\n      var buffer = new Uint8Array(rawData.length);\n\n      for (var i = 0; i < rawData.length; ++i) {\n        buffer[i] = rawData.charCodeAt(i);\n      }\n      return buffer;\n    }\n  }]);\n\n  return EncryptionHelper;\n}();\n\nvar EncryptionHelperFactory = function () {\n  function EncryptionHelperFactory() {\n    _classCallCheck(this, EncryptionHelperFactory);\n  }\n\n  _createClass(EncryptionHelperFactory, null, [{\n    key: 'generateHelper',\n    value: function generateHelper(options) {\n      return Promise.resolve().then(function () {\n        if (options && options.serverKeys) {\n          return EncryptionHelperFactory.importKeys(options);\n        }\n\n        return EncryptionHelperFactory.generateKeys(options);\n      }).then(function (keys) {\n        var salt = null;\n        if (options && options.salt) {\n          salt = EncryptionHelper.base64UrlToUint8Array(options.salt);\n        } else {\n          salt = crypto.getRandomValues(new Uint8Array(16));\n        }\n        return new EncryptionHelper(keys, salt);\n      });\n    }\n  }, {\n    key: 'importKeys',\n    value: function importKeys(options) {\n      if (!options || !options.serverKeys || !options.serverKeys.publicKey || !options.serverKeys.privateKey) {\n        return Promise.reject(new Error('Bad options for key import'));\n      }\n\n      return Promise.resolve().then(function () {\n        return EncryptionHelper.stringKeysToCryptoKeys(options.serverKeys.publicKey, options.serverKeys.privateKey);\n      });\n    }\n  }, {\n    key: 'generateKeys',\n    value: function generateKeys() {\n      // True is to make the keys extractable\n      return crypto.subtle.generateKey({ name: 'ECDH', namedCurve: 'P-256' }, true, ['deriveBits']);\n    }\n  }, {\n    key: 'generateSalt',\n    value: function generateSalt() {\n      return crypto.getRandomValues(new Uint8Array(SALT_BYTES));\n    }\n  }]);\n\n  return EncryptionHelperFactory;\n}();\n\nif (typeof window !== 'undefined') {\n  window.gauntface = window.gauntface || {};\n  window.gauntface.EncryptionHelperFactory = EncryptionHelperFactory;\n  window.gauntface.EncryptionHelper = EncryptionHelper;\n}\n\n// from Material Design Lite website\n// @see https://getmdl.io/assets/snippets.js\n/* eslint-env browser */\n\nvar MaterialComponentsSnippets = function () {\n  function MaterialComponentsSnippets() {\n    _classCallCheck(this, MaterialComponentsSnippets);\n\n    this.snippets = document.querySelectorAll('code.language-markup');\n  }\n\n  _createClass(MaterialComponentsSnippets, [{\n    key: 'init',\n    value: function init() {\n      var _this11 = this;\n\n      Array.from(this.snippets).forEach(function (snippet) {\n        snippet.addEventListener('click', _this11.onMouseClickHandler(snippet));\n        snippet.addEventListener('mouseout', _this11.onMouseOutHandler(snippet));\n      });\n    }\n  }, {\n    key: 'copyToClipboard',\n    value: function copyToClipboard(snippet) {\n      var selection = window.getSelection();\n      var range = document.createRange();\n      range.selectNodeContents(snippet);\n      selection.removeAllRanges();\n      selection.addRange(range);\n      var successful = false;\n      try {\n        successful = document.execCommand('copy');\n      } catch (err) {\n        successful = false;\n      }\n      selection.removeAllRanges();\n      return successful;\n    }\n  }, {\n    key: 'onMouseClickHandler',\n    value: function onMouseClickHandler(snippet) {\n      var _this12 = this;\n\n      return function () {\n        if (!(window.getSelection().toString().length > 0)) {\n          var successful = _this12.copyToClipboard(snippet);\n          snippet.classList.add(successful ? MaterialComponentsSnippets.CssClasses_.COPIED : MaterialComponentsSnippets.CssClasses_.NOT_SUPPORTED);\n        }\n      };\n    }\n  }, {\n    key: 'onMouseOutHandler',\n    value: function onMouseOutHandler(snippet) {\n      return function () {\n        snippet.classList.remove(MaterialComponentsSnippets.CssClasses_.COPIED);\n      };\n    }\n  }], [{\n    key: 'CssClasses_',\n    get: function get() {\n      return {\n        COPIED: 'copied',\n        NOT_SUPPORTED: 'nosupport'\n      };\n    }\n  }]);\n\n  return MaterialComponentsSnippets;\n}();\n\nvar AppController = function () {\n  function AppController() {\n    var _this13 = this;\n\n    _classCallCheck(this, AppController);\n\n    // Define a different server URL here if desire.\n    this._PUSH_SERVER_URL = '';\n    this._API_KEY = 'AIzaSyBBh4ddPa96rQQNxqiq_qQj7sq1JdsNQUQ';\n\n    // This div contains the UI for CURL commands to trigger a push\n    this._sendPushOptions = document.querySelector('.js-send-push-options');\n    this._payloadTextField = document.querySelector('.js-payload-textfield');\n    this._stateMsg = document.querySelector('.js-state-msg');\n    this._payloadTextField.oninput = function () {\n      Promise.all([_this13.updateCurlCommand(), _this13.updateXHRButton()]).then(function () {\n        _this13.updateOrMessage();\n      });\n    };\n\n    // Below this comment is code to initialise a material design lite view.\n    var toggleSwitch = document.querySelector('.js-push-toggle-switch');\n    if (toggleSwitch.classList.contains('is-upgraded')) {\n      this.ready = Promise.resolve();\n      this._uiInitialised(toggleSwitch.MaterialSwitch);\n    } else {\n      this.ready = new Promise(function (resolve) {\n        var mdlUpgradeCb = function mdlUpgradeCb() {\n          if (!toggleSwitch.classList.contains('is-upgraded')) {\n            return;\n          }\n\n          _this13._uiInitialised(toggleSwitch.MaterialSwitch);\n          document.removeEventListener(mdlUpgradeCb);\n\n          resolve();\n        };\n\n        // This is to wait for MDL initialising\n        document.addEventListener('mdl-componentupgraded', mdlUpgradeCb);\n      });\n    }\n  }\n\n  _createClass(AppController, [{\n    key: '_uiInitialised',\n    value: function _uiInitialised(toggleSwitch) {\n      var _this14 = this;\n\n      this._stateChangeListener = this._stateChangeListener.bind(this);\n      this._subscriptionUpdate = this._subscriptionUpdate.bind(this);\n\n      this._toggleSwitch = toggleSwitch;\n      this._pushClient = new PushClient(this._stateChangeListener, this._subscriptionUpdate);\n\n      document.querySelector('.js-push-toggle-switch > input').addEventListener('click', function (event) {\n        // Inverted because clicking will change the checked state by\n        // the time we get here\n        if (event.target.checked) {\n          _this14._pushClient.subscribeDevice();\n        } else {\n          _this14._pushClient.unsubscribeDevice();\n        }\n      });\n\n      var sendPushViaXHRButton = document.querySelector('.js-send-push-button');\n      sendPushViaXHRButton.addEventListener('click', function () {\n        if (_this14._currentSubscription) {\n          _this14.sendPushMessage(_this14._currentSubscription, _this14._payloadTextField.value);\n        }\n      });\n\n      // allow snippets to be copied via click\n      new MaterialComponentsSnippets().init();\n    }\n  }, {\n    key: 'registerServiceWorker',\n    value: function registerServiceWorker() {\n      var _this15 = this;\n\n      // Check that service workers are supported\n      if ('serviceWorker' in navigator) {\n        navigator.serviceWorker.register('./service-worker.js').catch(function (err) {\n          _this15.showErrorMessage('Unable to Register SW', 'Sorry this demo requires a service worker to work and it ' + 'was didn\\'t seem to install - sorry :(');\n          console.error(err);\n        });\n      } else {\n        this.showErrorMessage('Service Worker Not Supported', 'Sorry this demo requires service worker support in your browser. ' + 'Please try this demo in Chrome or Firefox Nightly.');\n      }\n    }\n  }, {\n    key: '_stateChangeListener',\n    value: function _stateChangeListener(state, data) {\n      // console.log(state);\n      if (typeof state.interactive !== 'undefined') {\n        if (state.interactive) {\n          this._toggleSwitch.enable();\n        } else {\n          this._toggleSwitch.disable();\n        }\n      }\n\n      if (typeof state.pushEnabled !== 'undefined') {\n        if (state.pushEnabled) {\n          this._toggleSwitch.on();\n        } else {\n          this._toggleSwitch.off();\n        }\n      }\n\n      switch (state.id) {\n        case 'ERROR':\n          this.showErrorMessage('Ooops a Problem Occurred', data);\n          break;\n        default:\n          console.log('ID ===> ', state.id);\n          break;\n      }\n    }\n  }, {\n    key: '_subscriptionUpdate',\n    value: function _subscriptionUpdate(subscription) {\n      var _this16 = this;\n\n      this._currentSubscription = subscription;\n\n      if (!subscription) {\n        // Remove any subscription from your servers if you have\n        // set it up.\n        this._sendPushOptions.style.opacity = 0;\n        return;\n      }\n\n      // This is too handle old versions of Firefox where keys would exist\n      // but auth wouldn't\n      var payloadTextfieldContainer = document.querySelector('.js-payload-textfield-container');\n      var subscriptionObject = JSON.parse(JSON.stringify(subscription));\n      if (subscriptionObject && subscriptionObject.keys && subscriptionObject.keys.auth && subscriptionObject.keys.p256dh) {\n        payloadTextfieldContainer.classList.remove('hidden');\n      } else {\n        payloadTextfieldContainer.classList.add('hidden');\n      }\n\n      Promise.all([this.updateCurlCommand(), this.updateXHRButton()]).then(function () {\n        _this16.updateOrMessage();\n      });\n\n      // Display the UI\n      this._sendPushOptions.style.opacity = 1;\n    }\n  }, {\n    key: 'updateCurlCommand',\n    value: function updateCurlCommand() {\n      var _this17 = this;\n\n      var payloadText = this._payloadTextField.value;\n      var payloadPromise = Promise.resolve(null);\n      if (payloadText && payloadText.trim().length > 0) {\n        payloadPromise = EncryptionHelperFactory.generateHelper().then(function (encryptionHelper) {\n          return encryptionHelper.encryptMessage(JSON.parse(JSON.stringify(_this17._currentSubscription)), payloadText);\n        });\n      }\n\n      return payloadPromise.then(function (encryptedPayload) {\n        var curlContainer = document.querySelector('.js-curl-container');\n        var curlCommand = void 0;\n\n        // GCM Command\n        if (_this17._currentSubscription.endpoint.indexOf('https://android.googleapis.com/gcm/send') === 0) {\n          curlCommand = _this17.produceGCMProprietaryCURLCommand(_this17._currentSubscription, encryptedPayload);\n\n          // Web Push Protocol\n        } else if (payloadText && payloadText.trim().length > 0) {\n            // Turn off curl command\n            curlContainer.style.display = 'none';\n            _this17._stateMsg.textContent = 'Note: Push messages with a payload ' + 'can\\'t be sent with a cURL command due to the body of the web ' + 'push protocol request being a stream.';\n            return;\n          } else {\n            _this17._stateMsg.textContent = '';\n            curlCommand = _this17.produceWebPushProtocolCURLCommand(_this17._currentSubscription, encryptedPayload);\n          }\n\n        curlContainer.style.display = 'block';\n        var curlCodeElement = document.querySelector('.js-curl-code');\n        curlCodeElement.innerHTML = curlCommand;\n      });\n    }\n  }, {\n    key: 'updateXHRButton',\n    value: function updateXHRButton() {\n      var buttonContainer = document.querySelector('.js-xhr-button-container');\n      if (this._currentSubscription.endpoint.indexOf('https://android.googleapis.com/gcm/send') === 0 && this._payloadTextField.value.trim().length > 0) {\n        buttonContainer.style.display = 'none';\n        return;\n      }\n\n      buttonContainer.style.display = 'block';\n    }\n  }, {\n    key: 'updateOrMessage',\n    value: function updateOrMessage() {\n      var orMessage = document.querySelector('.js-push-options-or');\n      var buttonContainer = document.querySelector('.js-xhr-button-container');\n      var curlContainer = document.querySelector('.js-curl-container');\n\n      var orDisplay = buttonContainer.style.display === 'none' || curlContainer.style.display === 'none' ? 'none' : 'block';\n\n      orMessage.style.display = orDisplay;\n    }\n  }, {\n    key: 'sendPushMessage',\n    value: function sendPushMessage(subscription, payloadText) {\n      var _this18 = this;\n\n      var payloadPromise = Promise.resolve(null);\n      if (payloadText && payloadText.trim().length > 0) {\n        payloadPromise = EncryptionHelperFactory.generateHelper().then(function (encryptionHelper) {\n          return encryptionHelper.encryptMessage(JSON.parse(JSON.stringify(subscription)), payloadText);\n        });\n      }\n\n      payloadPromise.then(function (encryptedPayload) {\n        if (subscription.endpoint.indexOf('https://android.googleapis.com/gcm/send') === 0) {\n          _this18.useGCMProtocol(subscription, encryptedPayload);\n        } else {\n          _this18.useWebPushProtocol(subscription, encryptedPayload);\n        }\n      });\n    }\n  }, {\n    key: 'toBase64',\n    value: function toBase64(arrayBuffer, start, end) {\n      start = start || 0;\n      end = end || arrayBuffer.byteLength;\n\n      var partialBuffer = new Uint8Array(arrayBuffer.slice(start, end));\n      return btoa(String.fromCharCode.apply(null, partialBuffer));\n    }\n  }, {\n    key: 'useGCMProtocol',\n    value: function useGCMProtocol(subscription, encryptedPayload) {\n      var _this19 = this;\n\n      console.log('Sending XHR to GCM Protocol endpoint');\n\n      var headers = new Headers();\n      headers.append('Content-Type', 'application/json');\n      headers.append('Authorization', 'key=' + this._API_KEY);\n\n      var endpointSections = subscription.endpoint.split('/');\n      var subscriptionId = endpointSections[endpointSections.length - 1];\n      var msgBody = {\n        registration_ids: [subscriptionId] // eslint-disable-line camelcase\n      };\n\n      if (encryptedPayload) {\n        msgBody.raw_data = this.toBase64(encryptedPayload.cipherText); // eslint-disable-line camelcase\n\n        headers.append('Encryption', 'salt=' + encryptedPayload.salt);\n        headers.append('Crypto-Key', 'dh=' + encryptedPayload.publicServerKey);\n        headers.append('Content-Encoding', 'aesgcm');\n      }\n\n      fetch('https://android.googleapis.com/gcm/send', {\n        method: 'post',\n        headers: headers,\n        body: JSON.stringify(msgBody)\n      }).then(function (response) {\n        if (response.type === 'opaque') {\n          return;\n        }\n\n        return response.json().then(function (responseObj) {\n          if (responseObj.failure !== 0) {\n            console.log('Failed GCM response: ', responseObj);\n            throw new Error('Failed to send push message via GCM');\n          }\n        });\n      }).catch(function (err) {\n        _this19.showErrorMessage('Ooops Unable to Send a Push', err);\n      });\n    }\n  }, {\n    key: 'useWebPushProtocol',\n    value: function useWebPushProtocol(subscription, encryptedPayload) {\n      var _this20 = this;\n\n      console.log('Sending XHR to Web Push Protocol endpoint');\n      var headers = new Headers();\n      headers.append('TTL', 60);\n\n      var fetchOptions = {\n        method: 'post',\n        headers: headers\n      };\n\n      if (encryptedPayload) {\n        fetchOptions.body = encryptedPayload.cipherText;\n\n        headers.append('Encryption', 'salt=' + encryptedPayload.salt);\n        headers.append('Crypto-Key', 'dh=' + encryptedPayload.publicServerKey);\n        headers.append('Content-Encoding', 'application/octet-stream');\n        headers.append('Content-Encoding', 'aesgcm');\n      }\n\n      fetch(subscription.endpoint, fetchOptions).then(function (response) {\n        if (response.status >= 400 && response.status < 500) {\n          console.log('Failed web push response: ', response, response.status);\n          throw new Error('Failed to send push message via web push protocol');\n        }\n      }).catch(function (err) {\n        _this20.showErrorMessage('Ooops Unable to Send a Push', err);\n      });\n    }\n  }, {\n    key: 'produceGCMProprietaryCURLCommand',\n    value: function produceGCMProprietaryCURLCommand(subscription, encryptedPayload) {\n      var additionalHeaders = '';\n      var additionalBody = '';\n      if (encryptedPayload) {\n        additionalBody = ', \\\\\"raw_data\\\\\": \\\\\"' + this.toBase64(encryptedPayload.cipherText) + '\\\\\"';\n\n        additionalHeaders += ' --header \"Encryption: salt=' + encryptedPayload.salt + '\"';\n        additionalHeaders += ' --header \"Crypto-Key: dh=' + encryptedPayload.publicServerKey + '\"';\n        additionalHeaders += ' --header \"Content-Encoding: aesgcm\"';\n\n        this._stateMsg.textContent = 'Note: Push messages with a payload ' + 'can\\'t be sent to GCM due to a CORs issue. Trigger a push ' + 'message with the cURL command below.';\n      } else {\n        this._stateMsg.textContent = '';\n      }\n\n      var curlEndpoint = 'https://android.googleapis.com/gcm/send';\n      var endpointSections = subscription.endpoint.split('/');\n      var subscriptionId = endpointSections[endpointSections.length - 1];\n      var curlCommand = 'curl --header \"Authorization: key=' + this._API_KEY + '\" --header \"Content-Type: application/json\"' + additionalHeaders + ' ' + curlEndpoint + ' -d \"{\\\\\"to\\\\\":\\\\\"' + subscriptionId + '\\\\\"' + additionalBody + '}\"';\n      return curlCommand;\n    }\n  }, {\n    key: 'produceWebPushProtocolCURLCommand',\n    value: function produceWebPushProtocolCURLCommand(subscription) {\n      // Payload body is a byte array so can't add to cURL command\n      var curlEndpoint = subscription.endpoint;\n      var curlCommand = 'curl --header \"TTL: 60\" --request POST ' + curlEndpoint;\n      return curlCommand;\n    }\n  }, {\n    key: 'showErrorMessage',\n    value: function showErrorMessage(title, message) {\n      var errorContainer = document.querySelector('.js-error-message-container');\n\n      var titleElement = errorContainer.querySelector('.js-error-title');\n      var messageElement = errorContainer.querySelector('.js-error-message');\n      titleElement.textContent = title;\n      messageElement.innerHTML = message;\n      errorContainer.style.opacity = 1;\n\n      var pushOptionsContainer = document.querySelector('.js-send-push-options');\n      pushOptionsContainer.style.display = 'none';\n    }\n  }]);\n\n  return AppController;\n}();\n\nmodule.exports = AppController;\n\n},{}]},{},[1]);\n"],"sourceRoot":"/source/"}